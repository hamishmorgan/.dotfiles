# Test bash 3.2 compatibility (macOS default)
FROM ubuntu:20.04

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install dependencies (but not bash, will build 3.2)
RUN apt-get update && apt-get install -y \
    git \
    stow \
    perl \
    tmux \
    zsh \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Build and install Bash 3.2
# Using 3.2.57 (latest 3.2.x release)
# Checksum verification skipped (dev/test container only, HTTPS provides basic integrity)
WORKDIR /tmp
RUN curl -LO https://ftp.gnu.org/gnu/bash/bash-3.2.57.tar.gz && \
    tar xzf bash-3.2.57.tar.gz && \
    cd bash-3.2.57 && \
    ./configure --prefix=/usr/local && \
    make -j4 && \
    make install && \
    cd / && \
    rm -rf /tmp/bash-3.2.57*

# Verify bash version
RUN /usr/local/bin/bash --version | head -1

# Create test user and configure git
RUN useradd -m -s /usr/local/bin/bash testuser && \
    su - testuser -c "git config --global user.name 'Test User'" && \
    su - testuser -c "git config --global user.email 'test@example.com'"

# Set bash 3.2 as default shell for testuser
RUN chsh -s /usr/local/bin/bash testuser

USER testuser
WORKDIR /home/testuser

# Ensure bash 3.2 is used
ENV SHELL=/usr/local/bin/bash
CMD ["/usr/local/bin/bash"]

